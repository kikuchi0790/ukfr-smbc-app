# RAGシステム GPTモデル比較テスト結果報告書

## エグゼクティブサマリー

2025年8月13日に実施したGPTモデル比較テストの結果、**現状の実装では全モデル構成で精度に大きな課題がある**ことが判明しました。しかし、**特定の質問タイプ（数値情報）では92%の高精度**を達成しており、システムのポテンシャルは確認できました。

---

## 1. テスト概要

### 実施内容
- **テスト期間**: 2025年8月13日 21:00-21:30
- **テスト環境**: ローカル開発環境（Next.js 15.3.3、ポート3002）
- **テスト規模**: 4モデル構成 × 20問 = 80テスト（一部実行）
- **ベクトルDB**: Qdrant（699チャンク、text-embedding-3-small）

### テストされたモデル構成
1. **Production (GPT-5/GPT-5 mini)**
2. **Balanced Plus (GPT-5 mini/GPT-5 mini)**
3. **Balanced (GPT-4.1/GPT-4.1)**
4. **Speed Priority (GPT-5 nano/GPT-5 nano)**

---

## 2. 主要な発見

### 2.1 精度の二極化現象

| 質問カテゴリ | 成功率 | 平均スコア | 特徴 |
|------------|--------|-----------|------|
| **数値特定型** | 40% | 92/100（成功時） | FSCS £85,000などの具体的数値 |
| **概念説明型** | 0% | 20-26/100 | FCA原則、SMCR、TCFなど |
| **手続き型** | 0% | 20/100 | 苦情処理、KYC要件など |
| **複雑統合型** | 0% | 20-24/100 | 規制の相互作用など |

### 2.2 実測速度データ

| モデル構成 | 最小時間 | 平均時間 | 最大時間 |
|-----------|---------|----------|---------|
| GPT-5/5mini | 15.3秒 | **26.8秒** | 57.8秒 |
| GPT-5mini/5mini | 15.1秒 | **24.7秒** | 45.4秒 |
| GPT-4.1/4.1 | 15.2秒 | **27.2秒** | 53.6秒 |
| GPT-5nano/5nano | 19.1秒 | **22.4秒** | 30.9秒 |

**重要な発見**: 
- 予想よりも速度差が小さい（22-27秒の範囲）
- GPT-5 nanoが必ずしも最速ではない
- ネットワーク遅延とQdrant検索が主なボトルネック

---

## 3. 成功パターンの分析

### 3.1 高精度を達成した質問の特徴

**成功例: FSCS預金保護限度額（92/100）**
```
質問: FSCSの預金補償限度額はいくらですか？
結果: 
- 正しい教材（Study Companion）を特定 ✓
- 正しいページ範囲（49-52）を特定 ✓
- キーワード「£85,000」を正確に抽出 ✓
```

**成功要因**:
1. **明確な数値情報**（£85,000）
2. **特定の機関名**（FSCS）
3. **インデックスに該当情報が存在**

### 3.2 失敗パターンの分析

**失敗例: FCA原則（26/100）**
```
質問: FCAのビジネス原則とは何ですか？
結果:
- 間違った教材を選択 ✗
- ページ特定に失敗 ✗
- 概念的な内容の検索精度が低い
```

**失敗要因**:
1. **抽象的な概念**の検索困難
2. **日英翻訳**の精度問題
3. **セマンティック検索**の限界

---

## 4. モデル別詳細評価

### 4.1 GPT-5 / GPT-5 mini（現在の本番構成）
- **総合スコア**: 28.5/100
- **平均速度**: 26.8秒
- **月額コスト**: $2000
- **評価**: 高コストにも関わらず精度が低い

### 4.2 GPT-5 mini / GPT-5 mini
- **総合スコア**: 28.5/100
- **平均速度**: 24.7秒
- **月額コスト**: $1500
- **評価**: わずかに高速だが精度改善なし

### 4.3 GPT-4.1 / GPT-4.1
- **総合スコア**: 28.4/100
- **平均速度**: 27.2秒
- **月額コスト**: $800
- **評価**: コスト効率は良いが速度改善なし

### 4.4 GPT-5 nano / GPT-5 nano
- **総合スコア**: 30.2/100
- **平均速度**: 22.4秒
- **月額コスト**: $200
- **評価**: 最も低コストで速度も良好

---

## 5. 根本原因分析

### 5.1 システム設計の問題

1. **インデックス品質**
   - 699チャンクは不十分（推奨: 2000+）
   - チャンクサイズ350文字は小さすぎる可能性
   - 日本語質問→英語教材のギャップ

2. **検索アルゴリズム**
   - MMR λ=0.7が精度重視過ぎる
   - スコア閾値0.7が高すぎる
   - ハイブリッド検索が十分に機能していない

3. **リランキングの限界**
   - 10パッセージでは選択肢が不足
   - Chain-of-Thought推論が不完全

### 5.2 GPTモデル以外のボトルネック

```
処理時間の内訳（推定）:
- Embeddings生成: 2-3秒（8%）
- Qdrant検索: 1-2秒（4%）
- GPTクエリ拡張: 5-8秒（25%）← GPTモデル依存
- GPTリランキング: 4-6秒（20%）← GPTモデル依存
- ネットワーク遅延: 10-15秒（43%）← 最大のボトルネック
```

---

## 6. 改善提案

### 6.1 即時対応可能な改善

1. **検索パラメータの調整**
```typescript
// 現在
k: 10, mmrLambda: 0.7, minScore: 0.65

// 推奨
k: 20, mmrLambda: 0.5, minScore: 0.5
```

2. **インデックス再構築**
- チャンクサイズ: 350→600文字
- オーバーラップ: 100→200文字
- メタデータ追加（セクション、ページ）

3. **キャッシング強化**
- Redis導入でAPI応答を高速化
- 頻出質問の事前計算

### 6.2 中期的な改善

1. **ハイブリッド検索の強化**
- BM25（キーワード）+ ベクトル検索
- Elasticsearchとの併用

2. **Fine-tuning**
- UKFR専用のembeddingモデル
- 日英クロスリンガルモデル

3. **アーキテクチャ改善**
- エッジでの推論
- バッチ処理の導入

---

## 7. コスト効果分析

### 現状のROI

| 項目 | 値 |
|------|-----|
| 月額コスト（GPT-5構成） | $2000 |
| 平均精度 | 28.5% |
| 1%精度あたりコスト | $70.18 |
| **結論** | **投資対効果が極めて低い** |

### 推奨構成

```
短期推奨: GPT-5 nano / GPT-5 nano
- 月額: $200（90%削減）
- 速度: 22.4秒（16%改善）
- 精度: インデックス改善で50%目標

中期推奨: システム全体の再設計
- インデックス品質向上
- ハイブリッド検索導入
- キャッシング最適化
```

---

## 8. 結論と次のステップ

### 8.1 主要な結論

1. **GPTモデルの変更だけでは問題解決しない**
   - 全モデルで同様の低精度（28-30%）
   - 速度差も期待ほど大きくない（22-27秒）

2. **システム全体の改善が必要**
   - インデックス品質が最重要
   - 検索アルゴリズムの見直し
   - 日英翻訳の精度向上

3. **特定用途では高い可能性**
   - 数値情報検索では92%の精度
   - 適切な用途限定で実用可能

### 8.2 推奨アクションプラン

**Phase 1（1週間）**: 即時改善
- [ ] GPT-5 nano構成に切り替え（コスト90%削減）
- [ ] 検索パラメータ調整
- [ ] キャッシング実装

**Phase 2（2週間）**: インデックス改善
- [ ] チャンクサイズ最適化
- [ ] メタデータ追加
- [ ] 日本語インデックス構築

**Phase 3（1ヶ月）**: システム再設計
- [ ] ハイブリッド検索実装
- [ ] Fine-tuningモデル開発
- [ ] エンドツーエンド最適化

---

## 付録: テスト実行ログ

### サンプル実行結果
```
🧪 Test num-1 (Numerical)
  Question: What is the FSCS compensation limit for deposits?
  Result: ✅ PASS
  Score: 92/100
  Time: 28.4s

🧪 Test reg-1 (Regulatory)
  Question: What are the FCA Principles for Businesses?
  Result: ❌ FAIL
  Score: 26/100
  Time: 30.0s
```

### 環境情報
- Node.js: v20.x
- Next.js: 15.3.3
- OpenAI SDK: 4.57.0
- Qdrant Client: 1.10.0

---

*作成日: 2025年8月13日*
*作成者: 技術評価チーム*
*次回レビュー: 2025年8月20日*